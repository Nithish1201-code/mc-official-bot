# MC Official Bot - Docker Compose

version: '3.9'

services:
  # Backend API
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: production
      PORT: 3000
      API_KEY: ${API_KEY}
      MINECRAFT_PATH: ${MINECRAFT_PATH:-/minecraft}
      LOG_LEVEL: info
    volumes:
      - /var/lib/minecraft:/minecraft
      - ./backend/dist:/app/dist:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Discord Bot
  bot:
    build:
      context: .
      dockerfile: Dockerfile.bot
    environment:
      NODE_ENV: production
      DISCORD_BOT_TOKEN: ${DISCORD_BOT_TOKEN}
      DISCORD_APPLICATION_ID: ${DISCORD_APPLICATION_ID}
      BACKEND_URL: http://backend:3000
      BACKEND_API_KEY: ${API_KEY}
      LOG_LEVEL: info
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped

volumes:
  minecraft:
    driver: local
